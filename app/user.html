<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>STTC Web App</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="theme-color" content="salmon" />
    <link rel="manifest" href="manifest.json" />
    <link rel="shortcut icon" href="assets/img/favicon.png">
    <link rel="apple-touch-icon" href="icon/icon.png">
    <link rel="stylesheet" href="assets/css/bootstrap.css" />
    <link rel="stylesheet" href="assets/css/font-awesome.css" />
    <link rel="stylesheet" href="assets/css/ace-fonts.css" />
    <link rel="stylesheet" href="assets/css/ace.css" class="ace-main-stylesheet" id="main-ace-style" />
    <link rel="stylesheet" href="assets/css/ace-skins.css" />
    <link rel="stylesheet" href="assets/css/jquery-ui-1.10.4.custom.min.css " />
    <link rel="stylesheet" href="assets/css/template.css"/>
    <link rel="stylesheet" href="assets/css/sweet-alert.css">

    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/ace/ace.js"></script>


    <script src="assets/js/sweet-alert.js"></script>
    <script src="assets/js/handlebars-v3.js"></script>
    <script src="assets/js/localforage.js"></script>

    <script src="scripts/template.js"></script>
    <script src="scripts/app.js"></script>
    <script src="scripts/main.js"></script>
    <script src="scripts/api.js"></script>
    <script src="assets/js/html5-qrcode.min.js"></script>

  </head>
  <body class="no-skin">
		<div id="loader">
        <div class="loader"></div>
		</div>
		<div id="loader-backdrop" style="position: fixed; width:100vw; height:100vh; background-color:white; opacity:0.3; display:none; z-index:9;"></div>
    <div id="navbar" class="navbar navbar-default">
			<div class="navbar-container" id="navbar-container">
				<div class="navbar-header">YOUR INFORMATION</div>

			</div>
		</div>
    <div class="main-container" id="main-container">
      <script type="text/javascript">
        try{ace.settings.check('main-container' , 'fixed')}catch(e){}
      </script>
      <!-- #section:basics/sidebar -->

      <div id="sidebar" class="sidebar responsive" style="height:95vh; background-color:#f8f8f8dd;" data-sidebar="true" data-sidebar-scoll="true" data-sidebar-hover="true">
        <script type="text/javascript">
        try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
        </script>

        <ul class="nav nav-list">
          <li class="">
            <a href="javascript:changeUserPwd()" style="background-color:#f8f8f8dd;">
              <i class="menu-icon fa fa-key"></i>
              <span class="menu-text">เปลี่ยนรหัสผ่าน</span>
            </a>
          </li>
          <li class="">
            <a href="javascript:logout()" style="background-color:#f8f8f8dd;">
              <i class="menu-icon fa fa-arrow-left"></i>
              <span class="menu-text">ออกจากระบบ</span>
            </a>
          </li>
          </ul>
      </div>
      <!-- /section:basics/sidebar -->
      <div class="main-content">
        <div class="main-content-inner">
          <div id="sidebar2"
            class="sidebar h-sidebar navbar-collapse collapse"
            data-sidebar="true" data-sidebar-scoll="true"
            data-sidebar-hover="true" aria-expanded="false"
            style="height:1px;">
          </div>
          <div class="page-content" id="page-content">
            <input type="hidden" id="scan-type" value="" />
            <input type="hidden" id="code" value="" />
            <div id="cam" class="hide" style="position: absolute; top:0; left:0; height: 100vh; width:100vw; z-index:10;">
              <div id="reader" style="width:100%;"></div>
            </div>

            <div class="row" style="margin-top:30px;">
              <div class="col-xs-12" id="user-table">

              </div>
            </div>


            <div class="pg-footer">
              <div class="pg-footer-inner">
                <div class="pg-footer-content text-right">
                  <div class="footer-menu width-25 text-center">
                    <li><a href="index.html"><i class="fa fa-home fa-2x white"></i><span>หน้าหลัก</span></a></li>
                  </div>
                  <div class="footer-menu width-25 text-center">
                    <li><a href="javascript:change_pwd()"><i class="fa fa-key fa-2x fa-flip-vertical white"></i><span>เปลี่ยนรหัสผ่าน</span></a></li>
                  </div>
                  <div class="footer-menu width-25 text-center">
                    <li><a href="javascript:logout()"><i class="fa fa-sign-out fa-2x white"></i><span>ออกจากระบบ</span></a></li>
                  </div>
                  <div class="footer-menu width-25">
                    <li><a harf="#" onclick="changeCameraId()"><i class="fa fa-cog fa-2x white"></i><span>ตั้งค่ากล้อง</span></a></li>
                  </div>
                </div>
             </div>
           </div>

        </div> <!-- pang content -->
      </div><!-- main content inner -->
    </div><!-- main content -->
  </div><!-- /.main-container -->

  <div class="modal fade" id="user-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog" style="width:500px; max-width:95%; margin-left:auto; margin-right:auto;">
     <div class="modal-content">
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
         <h4 class="modal-title">Your Information</h4>
        </div>
        <div class="modal-body">
          <div class="row" id="user-table" style="padding-left:12px; padding-right:12px;">

          </div>
        </div>
     </div>
   </div>
  </div>

  <div class="modal fade" id="cameras-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog" style="width:500px; max-width:95%; margin-left:auto; margin-right:auto;">
     <div class="modal-content">
         <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
         <h4 class="modal-title">Choose Camera</h4>
         <input type="hidden" id="select-side" value="i" />
        </div>
        <div class="modal-body">
          <div class="row" id="cameras-list" style="padding-left:12px; padding-right:12px;">

          </div>
          <div class="err-label" id="camera-error"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-sm btn-default btn-100" onclick="closeModal('cameras-modal')">Close</button>
  				<button type="button" class="btn btn-sm btn-success btn-100" onclick="saveCameraId()">Choose</button>
        </div>
     </div>
   </div>
  </div>

  <script id="cameras-list-template" type="text/x-handlebarsTemplate">
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    {{#each this}}
    <div class="radio">
      <label>
        <input type="radio" name="camera_id" id="{{id}}" class="ace" maxlength="100"	value="{{id}}" />
        <span class="lbl">{{label}}</span>
      </label>
    </div>
    {{/each}}
  </div>
  </script>


    <script id="user-template" type="text/x-handlebarsTemplate">
      <table class="table table-bordered border-1">
        <tr><td class="fix-width-100">Username</td><td class="">{{uname}}</td></tr>
        <tr><td class="fix-width-100">ชื่อ</td><td class="">{{displayName}}</td></tr>
        <tr><td class="fix-width-100">เขต/พื้นที่</td><td class="">{{teamName}}</td></tr>
        <tr><td class="fix-width-100">ทีมติดตั้ง</td><td class="">{{team_group_name}}</td></tr>
        <tr><td class="fix-width-100">คลังต้นทาง</td><td class="">{{fromWhsCode}} : {{from_warehouse_name}}</td></tr>
        <tr><td class="fix-width-100">คลังปลายทาง</td><td class="">{{toWhsCode}} : {{to_warehouse_name}}</td></tr>
      </table>
    </script>
      <!-- ace scripts -->
    <script>
      window.addEventListener('load', function() {
          renderUserData();
      });

      function renderUserData() {
        let userdata = localStorage.getItem('userdata');

        if(userdata.length) {
          let data = JSON.parse(userdata);
          let source = $('#user-template').html();
          let output = $('#user-table');

          render(source, data, output);
        }
      }


      function change_pwd() {
        if(navigator.onLine) {
          window.location.href = "change_pwd.html";
        }
        else {
          swal({
            title:'ข้อผิดพลาด',
            text:'ไม่สามารถเปลี่ยนรหัสผ่านได้ในขณะออฟไลน์',
            type:'error'
          });
        }
      }


      function saveCameraId() {
        let camId = $("input[name='camera_id']:checked").val();

        if(camId === undefined || camId == "") {
          $('#camera-error').text("Please choose camera for use to scan");
          return false;
        }
        else {
          localStorage.setItem('cameraId', camId);
          closeModal('cameras-modal');
        }
      }


      function changeCameraId() {
        Html5Qrcode.getCameras().then(devices => {
          if(devices && devices.length) {
            let source = $('#cameras-list-template').html();
            let output = $('#cameras-list');
            let camId = localStorage.getItem('cameraId');
            render(source, devices, output);
            $('#'+camId).prop('checked', true);
            showModal('cameras-modal');
          }
        })
        .catch((error) => {
          console.log('error', error);
          swal({
            title:'Oops!',
            text: error,
            type:'error'
          });
        });
      }

    </script>
    <script src="assets/js/ace/ace.sidebar.js"></script>
    <script src="assets/js/ace/ace.sidebar-scroll-1.js"></script>
    <script src="assets/js/ace/ace.submenu-hover.js"></script>
  </body>
</html>
